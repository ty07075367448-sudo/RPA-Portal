<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RobotPat DX Portal</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Initial Data -->
    <script src="data/db.js"></script>
    <!-- Chart.js -->
    <script src="assets/chart.min.js"></script>
    <!-- Feather Icons -->
    <script src="assets/feather.min.js"></script>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div id="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-area">
                <div class="logo-icon">
                    <i data-feather="cpu"></i>
                </div>
                <span>RPAPortal</span>
            </div>

            <nav class="nav-menu">
                <a href="#dashboard" class="nav-item active" data-page="dashboard">
                    <i data-feather="grid"></i>
                    <span>ダッシュボード</span>
                </a>
                <a href="#rpas" class="nav-item" data-page="rpas">
                    <i data-feather="list"></i>
                    <span>RPA一覧</span>
                </a>
                <a href="#backlog" class="nav-item" data-page="backlog">
                    <i data-feather="trello"></i>
                    <span>開発バックログ</span>
                </a>
                <a href="#data" class="nav-item" data-page="data">
                    <i data-feather="database"></i>
                    <span>データ管理</span>
                </a>
            </nav>

            <div style="margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div class="nav-item" id="nav-login" onclick="App.showLoginModal()">
                    <i data-feather="log-in"></i>
                    <span style="font-size: 0.875rem;">管理者ログイン</span>
                </div>
                <div class="nav-item" id="nav-logout" onclick="App.logout()" style="display: none;">
                    <i data-feather="log-out"></i>
                    <span style="font-size: 0.875rem;">ログアウト</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header-actions">
                <h1 class="page-title" id="page-title">ダッシュボード</h1>
                <div class="actions">
                    <button class="btn btn-primary" id="add-rpa-btn">
                        <i data-feather="plus"></i>
                        <span>RPA登録</span>
                    </button>
                </div>
            </header>

            <!-- Dynamic Content Area -->
            <div id="content-area">
                <!-- Dashboard Template -->
                <div id="view-dashboard" class="view-section active">
                    <div class="dashboard-hero glass-panel">
                        <img src="assets/rpa-01.jpg" alt="Hero" class="hero-bg">
                        <div class="hero-content">
                            <h2 class="hero-title">RPA Automation Hub</h2>
                            <p class="hero-subtitle">全社の自動化稼働状況を一元管理し、削減効果を可視化します。</p>
                        </div>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card glass-panel">
                            <span class="kpi-label">総削減金額</span>
                            <div class="kpi-value">
                                <span id="kpi-saved-amount">0</span><span class="kpi-unit">円</span>
                            </div>
                        </div>
                        <div class="kpi-card glass-panel">
                            <span class="kpi-label">総削減時間</span>
                            <div class="kpi-value">
                                <span id="kpi-saved-hours">0</span><span class="kpi-unit">時間</span>
                            </div>
                        </div>
                        <div class="kpi-card glass-panel">
                            <span class="kpi-label">稼働RPA数</span>
                            <div class="kpi-value">
                                <span id="kpi-active-rpas">0</span><span class="kpi-unit">体</span>
                            </div>
                        </div>
                        <div class="kpi-card glass-panel">
                            <span class="kpi-label">単月実行数</span>
                            <div class="kpi-value">
                                <span id="kpi-run-count">0</span><span class="kpi-unit">回</span>
                            </div>
                        </div>
                        <div class="kpi-card glass-panel border-secondary">
                            <span class="kpi-label text-secondary font-bold">バックログ見込み削減時間</span>
                            <div class="kpi-value">
                                <span id="kpi-backlog-savings">0</span><span class="kpi-unit text-secondary">時間</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-main font-bold">クイックリンク</h3>
                            <button class="btn btn-ghost btn-sm text-primary flex items-center gap-1"
                                onclick="App.showQuickLinkModal()">
                                <i data-feather="settings" width="14"></i> 管理
                            </button>
                        </div>
                        <div id="quick-links-container">
                            <!-- JS Generated Cards -->
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="glass-panel">
                            <h3 class="mb-4 text-main font-bold">月別削減効果推移</h3>
                            <div class="chart-wrapper">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                        <div class="glass-panel">
                            <h3 class="mb-4 text-main font-bold">削減効果 Top 5</h3>
                            <div class="table-container">
                                <table id="top-rpa-table">
                                    <thead>
                                        <tr>
                                            <th>RPA名</th>
                                            <th class="text-right">削減額</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- JS Generated -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RPA List Template -->
                <div id="view-rpas" class="view-section" style="display: none;">
                    <div class="glass-panel mb-4">
                        <div class="filter-bar">
                            <div class="search-box">
                                <i data-feather="search"></i>
                                <input type="text" id="rpa-search" placeholder="RPA名、タグ、部署で検索..." class="search-input">
                            </div>
                            <div class="filters">
                                <select id="filter-dept" class="filter-select">
                                    <option value="">全部署</option>
                                    <!-- JS Generated -->
                                </select>
                                <select id="filter-status" class="filter-select">
                                    <option value="">全ステータス</option>
                                    <option value="scheduled">スケジュール実行</option>
                                    <option value="manual">手動実行</option>
                                </select>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="filter-no-recording">
                                    <span>録画未登録のみ</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel">
                        <div class="table-container">
                            <table class="data-table" id="rpa-list-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="name">RPA名 <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                        <th class="sortable" data-sort="department">部署 <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                        <th>ステータス</th>
                                        <th>リンク</th>
                                        <th>録画</th>
                                        <th class="sortable text-right" data-sort="savedMinutes">削減時間 <i
                                                data-feather="chevron-down" class="sort-icon"></i></th>
                                        <th class="sortable text-right" data-sort="savedAmount">削減金額 <i
                                                data-feather="chevron-down" class="sort-icon"></i></th>
                                        <th class="sortable" data-sort="updatedAt">更新日 <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- JS Generated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Backlog Template -->
                <div id="view-backlog" class="view-section" style="display: none;">
                    <div class="glass-panel mb-4">
                        <div class="filter-bar">
                            <div class="search-box">
                                <i data-feather="search"></i>
                                <input type="text" id="backlog-search" placeholder="タスク名、部署で検索..." class="search-input">
                            </div>
                            <div class="filters">
                                <select id="filter-backlog-dept" class="filter-select">
                                    <option value="">全部署</option>
                                    <!-- JS Generated -->
                                </select>
                                <select id="filter-backlog-priority" class="filter-select">
                                    <option value="">全優先度</option>
                                    <option value="High">高 (High)</option>
                                    <option value="Medium">中 (Medium)</option>
                                    <option value="Low">低 (Low)</option>
                                </select>
                                <select id="filter-backlog-status" class="filter-select">
                                    <option value="">全ステータス</option>
                                    <option value="Todo">未着手</option>
                                    <option value="In Progress">進行中</option>
                                    <option value="Review">確認中</option>
                                    <option value="Done">完了</option>
                                </select>
                            </div>
                            <button id="add-backlog-btn" class="btn btn-primary btn-sm">
                                <i data-feather="plus"></i> 新規登録
                            </button>
                        </div>
                    </div>

                    <!-- Backlog Add Form (Inline) -->
                    <div id="backlog-form-container" class="glass-panel mb-4" style="display: none;">
                        <h3 class="mb-4">バックログ新規登録/編集</h3>
                        <form id="backlog-form" onsubmit="event.preventDefault(); App.saveBacklog();">
                            <input type="hidden" id="backlog-id">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">業務名 <span class="text-red-400">*</span></label>
                                    <input type="text" id="backlog-title" class="form-control" required
                                        placeholder="例: 請求書作成業務">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">部署</label>
                                    <select id="backlog-department" class="form-select">
                                        <option value="全社">全社</option>
                                        <option value="本社">本社</option>
                                        <option value="支店">支店</option>
                                        <option value="ESキッチン">ESキッチン</option>
                                        <option value="BMC秋津">BMC秋津</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">優先度</label>
                                    <select id="backlog-priority" class="form-select">
                                        <option value="Medium">中 (Medium)</option>
                                        <option value="High">高 (High)</option>
                                        <option value="Low">低 (Low)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ステータス</label>
                                    <select id="backlog-status" class="form-select">
                                        <option value="Todo">未着手</option>
                                        <option value="In Progress">進行中</option>
                                        <option value="Review">確認中</option>
                                        <option value="Done">完了</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">見込み削減時間 (時間)</label>
                                    <input type="number" id="backlog-savedHours" class="form-control" min="0" step="0.1"
                                        placeholder="例: 0.5">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">備考</label>
                                <textarea id="backlog-notes" class="form-control" placeholder="詳細や注意点など"></textarea>
                            </div>
                            <div class="flex justify-end gap-4 mt-4">
                                <button type="button" class="btn btn-ghost"
                                    onclick="App.hideBacklogForm()">キャンセル</button>
                                <button type="submit" class="btn btn-primary"><i data-feather="save"></i> 保存</button>
                            </div>
                        </form>
                    </div>

                    <div class="glass-panel">
                        <div class="table-container">
                            <table class="data-table" id="backlog-list-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="title">業務名 <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                        <th class="sortable" data-sort="department">部署 <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                        <th class="sortable" data-sort="priority">優先度 <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                        <th class="sortable" data-sort="status">ステータス <i data-feather="chevron-down"
                                                class="sort-icon"></i></th>
                                        <th class="sortable text-right" data-sort="expectedSavedMinutesPerRun">見込効果 (時間)
                                            <i data-feather="chevron-down" class="sort-icon"></i>
                                        </th>
                                        <th style="width: 150px;">備考</th>
                                        <th style="width: 140px; text-align: center;">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- JS Generated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- RPA Detail Template -->
                <div id="view-rpa-detail" class="view-section" style="display: none;">
                    <div class="glass-panel mb-4">
                        <div class="detail-header">
                            <a href="#rpas" class="back-btn"><i data-feather="arrow-left"></i> 一覧へ戻る</a>
                            <div class="detail-title-group">
                                <h2 id="detail-rpa-name" class="text-xl font-bold">RPA Name</h2>
                                <span id="detail-rpa-status" class="badge">Status</span>
                            </div>
                            <button class="btn btn-secondary text-sm" onclick="App.goToEdit()"><i
                                    data-feather="edit-2"></i> 編集</button>
                        </div>

                        <div class="tabs">
                            <button class="tab-btn active" data-tab="overview">概要</button>
                            <button class="tab-btn" data-tab="runs">実行実績</button>
                            <button class="tab-btn" data-tab="analysis">分析</button>
                            <button class="tab-btn" data-tab="recordings">録画</button>
                        </div>

                        <!-- Tab: Overview -->
                        <div id="tab-overview" class="tab-pane active">
                            <div class="detail-stats-grid">
                                <div class="glass-panel" style="background: rgba(255,255,255,0.03); padding: 1rem;">
                                    <span class="text-muted text-sm">部署</span>
                                    <div id="detail-dept" class="text-lg font-medium mt-1">-</div>
                                </div>
                                <div class="glass-panel" style="background: rgba(255,255,255,0.03); padding: 1rem;">
                                    <span class="text-muted text-sm">開発工数</span>
                                    <div id="detail-dev-hours" class="text-lg font-medium mt-1">-</div>
                                </div>
                                <div class="glass-panel" style="background: rgba(255,255,255,0.03); padding: 1rem;">
                                    <span class="text-muted text-sm">累計削減時間</span>
                                    <div id="detail-total-saved" class="text-lg font-medium mt-1">-</div>
                                </div>
                                <div class="glass-panel" style="background: rgba(255,255,255,0.03); padding: 1rem;">
                                    <span class="text-muted text-sm">累計削減金額</span>
                                    <div id="detail-total-amount" class="text-lg font-medium mt-1 text-primary">-</div>
                                </div>
                            </div>

                            <div class="glass-panel" style="background: rgba(255,255,255,0.03);">
                                <h4 class="mb-2 text-main font-bold">説明</h4>
                                <p id="detail-desc" class="text-muted mb-4">-</p>

                                <h4 class="mb-2 text-main font-bold">タグ</h4>
                                <div id="detail-tags" class="flex gap-2 mb-4">
                                    <!-- Tags -->
                                </div>

                                <div class="mb-4">
                                    <span class="text-muted text-sm block mb-1">スプレッドシート: </span>
                                    <div id="detail-sheet-links" class="flex flex-col gap-1">
                                        <!-- JS Generated -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Runs -->
                        <div id="tab-runs" class="tab-pane">
                            <div class="table-container">
                                <table class="data-table" id="detail-runs-table">
                                    <thead>
                                        <tr>
                                            <th>実行日時</th>
                                            <th class="text-right">削減時間</th>
                                            <th class="text-right">実稼働</th>
                                            <th class="text-right">回数</th>
                                            <th>備考</th>
                                        </tr>
                                    </thead>
                                    <tbody><!-- JS Generated --></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tab: Analysis -->
                        <div id="tab-analysis" class="tab-pane">
                            <div class="flex flex-col items-center justify-center py-12 text-muted">
                                <i data-feather="bar-chart-2"
                                    style="width:48px;height:48px;opacity:0.3;margin-bottom:1rem;"></i>
                                <p>詳細分析機能は準備中です</p>
                            </div>
                        </div>

                        <!-- Tab: Recordings -->
                        <div id="tab-recordings" class="tab-pane">
                            <div id="detail-recordings-list" class="grid grid-cols-1 gap-4">
                                <!-- JS Generated -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Edit Template -->
                <div id="view-rpa-edit" class="view-section" style="display: none;">
                    <div class="detail-header">
                        <a href="#rpas" class="back-btn"><i data-feather="arrow-left"></i> キャンセル</a>
                        <h2 id="edit-page-title" class="text-xl font-bold">RPA登録</h2>
                        <div></div>
                    </div>

                    <form id="rpa-form" onsubmit="event.preventDefault(); App.saveRpa();">
                        <div class="glass-panel">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">RPA名 <span class="text-red-400">*</span></label>
                                    <input type="text" id="edit-name" class="form-control" required
                                        placeholder="例: 月次請求書処理ロボ">
                                    <input type="hidden" id="edit-id">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">部署 <span class="text-red-400">*</span></label>
                                    <select id="edit-department" class="form-select" required>
                                        <option value="">選択してください</option>
                                        <!-- JS populated -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">スプレッドシート (名前とURL)</label>
                                    <div id="edit-sheets-container" class="flex flex-col gap-2">
                                        <!-- JS Generated -->
                                    </div>
                                    <button type="button" class="btn btn-ghost btn-sm mt-1"
                                        onclick="App.addSheetInput()">
                                        <i data-feather="plus" width="14"></i> 行を追加
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">録画URL（Googleドライブ等）</label>
                                    <input type="url" id="edit-recordingUrl" class="form-control"
                                        placeholder="https://drive.google.com/...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">開発工数 (時間)</label>
                                    <input type="number" id="edit-devHours" class="form-control" min="0" step="0.5">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">月間削減時間 (時間)</label>
                                    <input type="number" id="edit-savedHours" class="form-control" min="0" step="0.5"
                                        placeholder="例: 10">
                                    <small class="text-muted">※削減金額は時給1,750円で自動計算されます</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">月間実行回数</label>
                                    <input type="number" id="edit-runCount" class="form-control" min="0" step="1"
                                        placeholder="例: 30">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">タグ (カンマ区切り)</label>
                                    <input type="text" id="edit-tags" class="form-control" placeholder="経理, 月次, 自動化">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">運用モード</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" name="operationMode" value="scheduled" checked> 自動実行
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="operationMode" value="manual"> 手動実行
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">説明</label>
                                <textarea id="edit-description" class="form-control"
                                    placeholder="ロボットの概要や注意事項など"></textarea>
                            </div>

                            <div class="border-t border-gray-700/50 pt-6 mt-6 flex justify-end gap-4">
                                <button type="button" class="btn btn-ghost" onclick="history.back()">キャンセル</button>
                                <button type="submit" class="btn btn-primary"><i data-feather="save"></i> 保存する</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Data Management Template -->
                <div id="view-data" class="view-section" style="display: none;">
                    <div class="glass-panel mb-6">
                        <h3 class="text-lg font-bold mb-2 text-main">データのエクスポート</h3>
                        <p class="text-muted text-sm mb-4">現在の全データをJSONファイルとしてダウンロードします。バックアップとしてご利用ください。</p>
                        <button id="btn-export" class="btn btn-primary"><i data-feather="download"></i>
                            JSONをダウンロード</button>
                    </div>

                    <div class="glass-panel mb-6">
                        <h3 class="text-lg font-bold mb-2 text-main">データのインポート</h3>
                        <p class="text-muted text-sm mb-4">バックアップしたJSONファイルを読み込み、現在のデータを上書きします。<br><span
                                class="text-yellow-400">※この操作は取り消せません。</span></p>
                        <div class="flex items-center gap-4">
                            <input type="file" id="file-import" accept=".json" class="text-sm text-muted">
                            <button id="btn-import" class="btn btn-secondary"><i data-feather="upload"></i>
                                インポート実行</button>
                        </div>
                    </div>

                    <div class="glass-panel border-red-900/30" style="background: rgba(220, 38, 38, 0.05);">
                        <h3 class="text-lg font-bold mb-2 text-red-400">データのリセット</h3>
                        <p class="text-muted text-sm mb-4">保存されたデータを削除し、初期状態（プリセットデータ）に戻します。<br><span
                                class="text-red-400">※完全に削除されます。</span></p>
                        <button id="btn-reset" class="btn btn-danger"
                            style="background: rgba(220, 38, 38, 0.2); color: #FCA5A5; border: 1px solid rgba(220, 38, 38, 0.4);"><i
                                data-feather="trash-2"></i> 初期化を実行</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>管理者ログイン</h3>
            <div class="form-group">
                <label for="login-email">メールアドレス</label>
                <input type="email" id="login-email" placeholder="admin@example.com">
            </div>
            <div class="form-group">
                <label for="login-password">パスワード</label>
                <input type="password" id="login-password">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="App.hideLoginModal()">キャンセル</button>
                <button class="btn btn-primary" onclick="App.login()">ログイン</button>
            </div>
        </div>
    </div>

    <!-- Quick Link Modal -->
    <div id="quick-link-modal" class="modal-overlay">
        <div class="modal-content glass-panel">
            <h3 id="ql-modal-title" class="mb-4">クイックリンクの管理</h3>
            <form id="ql-form" onsubmit="event.preventDefault(); App.saveQuickLink();">
                <input type="hidden" id="ql-id">
                <div class="form-group mb-4">
                    <label class="form-label">表示名</label>
                    <input type="text" id="ql-name" class="form-control" required placeholder="例: スケジュール表">
                </div>
                <div class="form-group mb-4">
                    <label class="form-label">URL</label>
                    <input type="url" id="ql-url" class="form-control" required placeholder="https://...">
                </div>
                <div class="form-group mb-4">
                    <label class="form-label">アイコンを選択</label>
                    <div id="icon-options" class="icon-selection-grid">
                        <!-- JS Generated -->
                    </div>
                    <input type="hidden" id="ql-icon" value="link">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" class="btn btn-ghost" onclick="App.hideQuickLinkModal()">キャンセル</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
</body>

</html>